<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ¸…ç†AIè¯†åˆ«æ•°æ®</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .card {
            background: white;
            border-radius: 12px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        .button {
            background: #007AFF;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            margin: 8px;
            transition: background 0.2s;
        }
        .button:hover {
            background: #0056CC;
        }
        .button.danger {
            background: #FF3B30;
        }
        .button.danger:hover {
            background: #D70015;
        }
        .button.success {
            background: #34C759;
        }
        .log-container {
            background: #1a1a1a;
            color: #00ff00;
            padding: 16px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            max-height: 400px;
            overflow-y: auto;
            margin-top: 16px;
        }
        .status {
            padding: 12px;
            border-radius: 8px;
            margin: 8px 0;
            font-weight: bold;
        }
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        .status.warning {
            background: #fff3cd;
            color: #856404;
            border: 1px solid #ffeaa7;
        }
        .data-preview {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 16px;
            margin: 16px 0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <div class="card">
        <h1>ğŸ§¹ æ¸…ç†AIè¯†åˆ«æ•°æ®å·¥å…·</h1>
        <p>è¿™ä¸ªå·¥å…·å¯ä»¥å¸®ä½ æ¸…ç†æµè§ˆå™¨ä¸­ä¿å­˜çš„AIè¯†åˆ«ç›¸å…³æ•°æ®ï¼Œè§£å†³"ä¸ºä»€ä¹ˆè¿˜æ˜¯ä¼šè¿›è¡ŒAIåˆ†æ"çš„é—®é¢˜ã€‚</p>
        
        <div id="status"></div>
        
        <h3>ğŸ” æ£€æŸ¥å½“å‰æ•°æ®</h3>
        <button class="button" onclick="checkCurrentData()">æ£€æŸ¥localStorageæ•°æ®</button>
        <button class="button" onclick="analyzeAIData()">åˆ†æAIè¯†åˆ«æ•°æ®</button>
        
        <div id="dataPreview"></div>
        
        <h3>ğŸ§¹ æ¸…ç†æ“ä½œ</h3>
        <button class="button danger" onclick="clearAIData()">æ¸…ç†AIè¯†åˆ«æ•°æ®</button>
        <button class="button danger" onclick="clearAllCheckInHistory()">æ¸…ç†æ‰€æœ‰æ‰“å¡å†å²</button>
        <button class="button danger" onclick="clearAllData()">æ¸…ç†æ‰€æœ‰åº”ç”¨æ•°æ®</button>
        
        <h3>ğŸ”„ é‡ç½®æ“ä½œ</h3>
        <button class="button success" onclick="createCleanUser()">åˆ›å»ºå¹²å‡€çš„æµ‹è¯•ç”¨æˆ·</button>
        <button class="button" onclick="refreshApp()">åˆ·æ–°åº”ç”¨é¡µé¢</button>
    </div>
    
    <div class="card">
        <h2>ğŸ“ æ“ä½œæ—¥å¿—</h2>
        <button class="button" onclick="clearLogs()">æ¸…ç©ºæ—¥å¿—</button>
        <div id="logContainer" class="log-container"></div>
    </div>

    <script>
        let logCount = 0;
        
        function log(message, type = 'info') {
            logCount++;
            const timestamp = new Date().toLocaleTimeString();
            const logContainer = document.getElementById('logContainer');
            const color = type === 'error' ? '#ff6b6b' : type === 'success' ? '#51cf66' : type === 'warning' ? '#ffd43b' : '#00ff00';
            
            logContainer.innerHTML += `<div style="color: ${color}">[${timestamp}] ${logCount}: ${message}</div>`;
            logContainer.scrollTop = logContainer.scrollHeight;
        }
        
        function clearLogs() {
            document.getElementById('logContainer').innerHTML = '';
            logCount = 0;
            log('æ—¥å¿—å·²æ¸…é™¤', 'info');
        }
        
        function showStatus(message, type = 'info') {
            const statusDiv = document.getElementById('status');
            statusDiv.innerHTML = `<div class="status ${type}">${message}</div>`;
            log(`çŠ¶æ€: ${message}`, type);
        }
        
        function checkCurrentData() {
            log('å¼€å§‹æ£€æŸ¥localStorageæ•°æ®...', 'info');
            
            try {
                const storageData = localStorage.getItem('fitness-contract-storage');
                
                if (!storageData) {
                    showStatus('âœ… localStorageä¸­æ²¡æœ‰åº”ç”¨æ•°æ®', 'success');
                    document.getElementById('dataPreview').innerHTML = '<div class="data-preview">æ²¡æœ‰æ‰¾åˆ°åº”ç”¨æ•°æ®</div>';
                    return;
                }
                
                const data = JSON.parse(storageData);
                log('æ‰¾åˆ°localStorageæ•°æ®ï¼Œæ­£åœ¨åˆ†æ...', 'info');
                
                // æ˜¾ç¤ºæ•°æ®é¢„è§ˆ
                document.getElementById('dataPreview').innerHTML = 
                    `<div class="data-preview">${JSON.stringify(data, null, 2)}</div>`;
                
                // åˆ†ææ•°æ®ç»“æ„
                const state = data.state;
                if (state) {
                    log(`ç”¨æˆ·: ${state.user ? state.user.nickname : 'æœªç™»å½•'}`, 'info');
                    log(`æ‰“å¡å†å²æ•°é‡: ${state.checkInHistory ? state.checkInHistory.length : 0}`, 'info');
                    log(`å¥‘çº¦å†å²æ•°é‡: ${state.contractHistory ? state.contractHistory.length : 0}`, 'info');
                    
                    if (state.checkInHistory && state.checkInHistory.length > 0) {
                        const aiResults = state.checkInHistory.filter(checkIn => 
                            checkIn.aiResult && checkIn.aiResult.recognized
                        );
                        log(`åŒ…å«AIè¯†åˆ«ç»“æœçš„æ‰“å¡: ${aiResults.length}`, aiResults.length > 0 ? 'warning' : 'success');
                        
                        if (aiResults.length > 0) {
                            showStatus(`âš ï¸ å‘ç° ${aiResults.length} æ¡åŒ…å«AIè¯†åˆ«ç»“æœçš„æ‰“å¡è®°å½•`, 'warning');
                        } else {
                            showStatus('âœ… æ²¡æœ‰å‘ç°AIè¯†åˆ«ç»“æœ', 'success');
                        }
                    } else {
                        showStatus('âœ… æ²¡æœ‰æ‰“å¡å†å²è®°å½•', 'success');
                    }
                } else {
                    showStatus('âŒ æ•°æ®æ ¼å¼å¼‚å¸¸', 'error');
                }
                
            } catch (error) {
                log(`æ£€æŸ¥æ•°æ®æ—¶å‡ºé”™: ${error.message}`, 'error');
                showStatus(`âŒ æ£€æŸ¥æ•°æ®å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function analyzeAIData() {
            log('å¼€å§‹åˆ†æAIè¯†åˆ«æ•°æ®...', 'info');
            
            try {
                const storageData = localStorage.getItem('fitness-contract-storage');
                
                if (!storageData) {
                    showStatus('âœ… æ²¡æœ‰æ•°æ®éœ€è¦åˆ†æ', 'success');
                    return;
                }
                
                const data = JSON.parse(storageData);
                const checkInHistory = data.state?.checkInHistory || [];
                
                log(`æ€»æ‰“å¡è®°å½•æ•°: ${checkInHistory.length}`, 'info');
                
                const aiResults = [];
                checkInHistory.forEach((checkIn, index) => {
                    if (checkIn.aiResult) {
                        aiResults.push({
                            index,
                            type: checkIn.type,
                            recognized: checkIn.aiResult.recognized,
                            confidence: checkIn.aiResult.confidence,
                            description: checkIn.aiResult.description,
                            timestamp: checkIn.timestamp
                        });
                    }
                });
                
                log(`åŒ…å«AIç»“æœçš„è®°å½•: ${aiResults.length}`, 'info');
                
                aiResults.forEach((result, i) => {
                    log(`è®°å½•${i + 1}: ${result.type} - ${result.description} (ç½®ä¿¡åº¦: ${result.confidence})`, 
                        result.recognized ? 'warning' : 'info');
                });
                
                if (aiResults.length > 0) {
                    showStatus(`ğŸ” åˆ†æå®Œæˆï¼šå‘ç° ${aiResults.length} æ¡AIè¯†åˆ«è®°å½•`, 'warning');
                } else {
                    showStatus('âœ… åˆ†æå®Œæˆï¼šæ²¡æœ‰å‘ç°AIè¯†åˆ«è®°å½•', 'success');
                }
                
            } catch (error) {
                log(`åˆ†æAIæ•°æ®æ—¶å‡ºé”™: ${error.message}`, 'error');
                showStatus(`âŒ åˆ†æå¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function clearAIData() {
            log('å¼€å§‹æ¸…ç†AIè¯†åˆ«æ•°æ®...', 'info');
            
            try {
                const storageData = localStorage.getItem('fitness-contract-storage');
                
                if (!storageData) {
                    showStatus('âœ… æ²¡æœ‰æ•°æ®éœ€è¦æ¸…ç†', 'success');
                    return;
                }
                
                const data = JSON.parse(storageData);
                const checkInHistory = data.state?.checkInHistory || [];
                
                // æ¸…ç†AIè¯†åˆ«ç»“æœ
                const cleanedHistory = checkInHistory.map(checkIn => ({
                    ...checkIn,
                    aiResult: {
                        recognized: false,
                        confidence: 0,
                        description: 'æ‰‹åŠ¨æ‰“å¡è®°å½•ï¼ˆå·²æ¸…ç†AIæ•°æ®ï¼‰'
                    }
                }));
                
                // æ›´æ–°æ•°æ®
                data.state.checkInHistory = cleanedHistory;
                localStorage.setItem('fitness-contract-storage', JSON.stringify(data));
                
                log(`å·²æ¸…ç† ${checkInHistory.length} æ¡è®°å½•çš„AIè¯†åˆ«æ•°æ®`, 'success');
                showStatus('âœ… AIè¯†åˆ«æ•°æ®æ¸…ç†å®Œæˆ', 'success');
                
            } catch (error) {
                log(`æ¸…ç†AIæ•°æ®æ—¶å‡ºé”™: ${error.message}`, 'error');
                showStatus(`âŒ æ¸…ç†å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function clearAllCheckInHistory() {
            log('å¼€å§‹æ¸…ç†æ‰€æœ‰æ‰“å¡å†å²...', 'info');
            
            try {
                const storageData = localStorage.getItem('fitness-contract-storage');
                
                if (!storageData) {
                    showStatus('âœ… æ²¡æœ‰æ•°æ®éœ€è¦æ¸…ç†', 'success');
                    return;
                }
                
                const data = JSON.parse(storageData);
                const originalCount = data.state?.checkInHistory?.length || 0;
                
                // æ¸…ç©ºæ‰“å¡å†å²
                if (data.state) {
                    data.state.checkInHistory = [];
                    data.state.todayCheckIns = [];
                }
                
                localStorage.setItem('fitness-contract-storage', JSON.stringify(data));
                
                log(`å·²æ¸…ç† ${originalCount} æ¡æ‰“å¡å†å²è®°å½•`, 'success');
                showStatus('âœ… æ‰€æœ‰æ‰“å¡å†å²å·²æ¸…ç†', 'success');
                
            } catch (error) {
                log(`æ¸…ç†æ‰“å¡å†å²æ—¶å‡ºé”™: ${error.message}`, 'error');
                showStatus(`âŒ æ¸…ç†å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function clearAllData() {
            log('å¼€å§‹æ¸…ç†æ‰€æœ‰åº”ç”¨æ•°æ®...', 'info');
            
            try {
                localStorage.removeItem('fitness-contract-storage');
                
                // æ¸…ç†å…¶ä»–ç›¸å…³æ•°æ®
                const keysToRemove = [];
                for (let i = 0; i < localStorage.length; i++) {
                    const key = localStorage.key(i);
                    if (key && (key.includes('fitness') || key.includes('coach') || key.includes('notification'))) {
                        keysToRemove.push(key);
                    }
                }
                
                keysToRemove.forEach(key => {
                    localStorage.removeItem(key);
                    log(`å·²åˆ é™¤: ${key}`, 'info');
                });
                
                log('æ‰€æœ‰åº”ç”¨æ•°æ®å·²æ¸…ç†', 'success');
                showStatus('âœ… æ‰€æœ‰åº”ç”¨æ•°æ®å·²æ¸…ç†', 'success');
                
            } catch (error) {
                log(`æ¸…ç†æ‰€æœ‰æ•°æ®æ—¶å‡ºé”™: ${error.message}`, 'error');
                showStatus(`âŒ æ¸…ç†å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function createCleanUser() {
            log('åˆ›å»ºå¹²å‡€çš„æµ‹è¯•ç”¨æˆ·...', 'info');
            
            try {
                const cleanUser = {
                    id: 'clean-user-' + Date.now(),
                    phone: '13800138000',
                    nickname: 'å¹²å‡€æµ‹è¯•ç”¨æˆ·',
                    age: 25,
                    height: 170,
                    weight: 65,
                    fitnessGoal: 'lose_weight',
                    createdAt: new Date().toISOString()
                };
                
                const cleanData = {
                    state: {
                        user: cleanUser,
                        isLoggedIn: true,
                        aiCoach: null,
                        currentContract: null,
                        contractHistory: [],
                        todayCheckIns: [],
                        checkInHistory: [], // ç©ºçš„æ‰“å¡å†å²
                        currentChatSession: null,
                        chatHistory: [],
                        loading: false,
                        error: null
                    },
                    version: 0
                };
                
                localStorage.setItem('fitness-contract-storage', JSON.stringify(cleanData));
                
                log('å¹²å‡€çš„æµ‹è¯•ç”¨æˆ·åˆ›å»ºæˆåŠŸ', 'success');
                showStatus('âœ… å¹²å‡€çš„æµ‹è¯•ç”¨æˆ·å·²åˆ›å»ºï¼Œæ²¡æœ‰ä»»ä½•AIè¯†åˆ«æ•°æ®', 'success');
                
            } catch (error) {
                log(`åˆ›å»ºç”¨æˆ·æ—¶å‡ºé”™: ${error.message}`, 'error');
                showStatus(`âŒ åˆ›å»ºç”¨æˆ·å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        function refreshApp() {
            log('åˆ·æ–°åº”ç”¨é¡µé¢...', 'info');
            
            try {
                // æ‰“å¼€æ–°çš„åº”ç”¨çª—å£
                window.open('http://localhost:5173', '_blank');
                log('åº”ç”¨é¡µé¢å·²åœ¨æ–°çª—å£ä¸­æ‰“å¼€', 'success');
                showStatus('âœ… åº”ç”¨é¡µé¢å·²åˆ·æ–°', 'success');
                
            } catch (error) {
                log(`åˆ·æ–°åº”ç”¨æ—¶å‡ºé”™: ${error.message}`, 'error');
                showStatus(`âŒ åˆ·æ–°å¤±è´¥: ${error.message}`, 'error');
            }
        }
        
        // é¡µé¢åŠ è½½æ—¶çš„åˆå§‹åŒ–
        window.onload = function() {
            log('AIæ•°æ®æ¸…ç†å·¥å…·å·²åŠ è½½', 'info');
            showStatus('ğŸ”§ è¯·å…ˆæ£€æŸ¥å½“å‰æ•°æ®ï¼Œç„¶åé€‰æ‹©åˆé€‚çš„æ¸…ç†æ“ä½œ', 'info');
            
            // è‡ªåŠ¨æ£€æŸ¥æ•°æ®
            setTimeout(checkCurrentData, 500);
        };
    </script>
</body>
</html>